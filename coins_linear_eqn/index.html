<html lang="en">
<head>
  <title>Coins Linear Equation</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0"/>
</head>

<script src="../libraries/core/d3.v4.min.js"></script>
<script src="../libraries/core/d3-selection-multi.v1.min.js"></script>
<script src="../libraries/core/jquery-3.2.1.min.js"></script>

<script src="../libraries/math/math.min.js"></script>

<script src="../libraries/ui/popper.min.js"></script>
<script src="../libraries/ui/bootstrap.min.js"></script>

<script type="text/x-mathjax-config"> MathJax.Hub.Config({ extensions: ["tex2jax.js"], jax: ["input/TeX","output/HTML-CSS"], tex2jax: { inlineMath: [["\(","\)"]] } }); </script>
<script type="text/javascript" src="../libraries/math/MathJax/MathJax.js"></script>

<link rel="stylesheet" href="../libraries/ui/bootstrap.min.css">
<link rel="stylesheet" href="../libraries/ui/font-awesome-4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="stylesheet.css">

<body>
  <div class = 'container text-center' style = 'width: 1000px;'>

    <div> <svg id = 'canvas' style = 'width: 800px; height: 500px;'></svg> </div>
    <div class= 'row'>

    <div class = 'col-md-4'>
      <div class = 'mt-2'> Number of ₹1 coins: <input id = 're1_input' type = 'number' min = '0' max = '20' value = '5'></input> </div>
      <div class = 'mt-2'> Number of ₹2 coins: <input id = 're2_input' type = 'number' min = '0' max = '20' value = '5'></input> </div>
      <div id = 'total_eqn' class = 'mt-4'></div>
      <div class = 'mt-2'>Total amount: <span id = 'total_value'></span> </div>
    </div>

    <div class = 'col-md-8'>
      <svg id = 'graph' style = 'width: 500px; height: 400px;'></svg>
    </div>

  </div>
  </div>
</body>

<script>

var re1 = 5, re2 = 5, total, nodes;
setupGraph();

d3.select('#re1_input').on('input', function(){
  if(this.value > 20){ this.value = 20; }
  re1 = this.value;
  update();
})

d3.select('#re2_input').on('input', function(){
  if(this.value > 20){ this.value = 20; }
  re2 = this.value;
  update();
})

/**************************************************************/

function update(){
  total = re1*1 + re2*2;
  var text = '\(' + re1+ '*₹1 + ' +re2+ '*₹2 = ₹' +total + '\)';
  d3.select('#total_eqn').html(text);
  d3.select('#total_value').html('' + total);
  MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
  drawCanvas();
  updateGraph();
} update();

/**************************************************************/

function drawCanvas(){
  nodes = [];
  d3.range(re1).forEach(function(i){ nodes.push({ r: 35, value: 1 }) });
  d3.range(re2).forEach(function(i){ nodes.push({ r: 40, value: 2 }) });

  d3.selectAll('.circle').remove();
  d3.select('#canvas')
    .append('g').attrs({ 'transform': 'translate(' +400+ ',' +250+ ')' })
    .selectAll('.circle').data(nodes).enter()
    .append('g').attrs({ class: 'circle' })
    .append('circle').attrs({ r: function(d){ return d.r }, fill: function(d){ if(d.value == 1){ return '#ff6347' } else{ return '#1e90ff' } } });

  d3.selectAll('.circle')
    .append('text').attrs({ class: 'circle_text' }).text( function(d){ return d.value } );

  var simulation = d3.forceSimulation(nodes)
    .velocityDecay(0.2)
    .force("x", d3.forceX().strength(0.005))
    .force("y", d3.forceY().strength(0.005))
    .force("collide", d3.forceCollide().radius(function(d) { return d.r + 3; }).iterations(2))
    .alphaTarget(0)
    .stop();

  for (var i = 0; i < 120; ++i) simulation.tick();
  d3.selectAll('.circle').each(function(d){
    d3.select(this).attrs({ 'transform': 'translate(' +d.x+ ',' +d.y+ ')' });
  })
}

/**************************************************************/

var xScale, yScale;
function setupGraph(){
  var graph = d3.select('#graph');
  var width = parseInt(graph.style('width'));
  var height = parseInt(graph.style('height'));

  var origin = graph.append('g').attrs({ id: 'origin', transform: 'translate(' +50+ ',' +(height-50)+ ')' });
  xScale = d3.scaleLinear().domain([0, 40]).range([0, 0.8*width]);
  yScale = d3.scaleLinear().domain([0, 20]).range([0, -0.8*height]);

  origin.append('g').call( d3.axisLeft(yScale) );
  origin.append('g').call( d3.axisBottom(xScale) );

  origin.append('line').attrs({ id: 'line' }).styles({ 'stroke': 'steelblue', 'stroke-width': 2 });
  origin.append('circle').attrs({ id: 'point', r: 3 }).styles({ 'stroke': 'orange', 'fill': 'red' });

  origin.append('line').attrs({ id: 'x-normal' }).styles({ 'stroke': 'gray', 'stroke-width': 2, 'stroke-dasharray': '3,3' });
  origin.append('line').attrs({ id: 'y-normal' }).styles({ 'stroke': 'gray', 'stroke-width': 2, 'stroke-dasharray': '3,3' });

  origin.append('g').attrs({ 'transform': 'translate(' +xScale(30)+ ',' +30+ ')' })
    .append('text').attrs({ class: 'axes_label' }).text('Number of ₹1 coins →')

  origin.append('g').attrs({ 'transform': 'translate(' +-30+ ',' +yScale(15)+ ') rotate(-90)' })
    .append('text').attrs({ class: 'axes_label' }).text('Number of ₹2 coins →')
}

function updateGraph(){
  var p1 = { x: 0, y: total/2 }, p2 = { x: total/1, y: 0 };
  d3.select('#line').attrs({ x1: xScale(p1.x), y1: yScale(p1.y), x2: xScale(p2.x), y2: yScale(p2.y) });
  d3.select('#point').attrs({ cx: xScale(re1), cy: yScale(re2) });

  d3.select('#x-normal').attrs({ x1: xScale(re1), y1: yScale(re2), x2: xScale(re1), y2: yScale(0) });
  d3.select('#y-normal').attrs({ x1: xScale(re1), y1: yScale(re2), x2: xScale(0), y2: yScale(re2) });
}

</script>
